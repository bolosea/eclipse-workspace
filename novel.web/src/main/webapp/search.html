<!DOCTYPE html>
<html>
 <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>小说搜搜-免费且无广告的小说阅读网</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
  </head>
<body>
	<nav class="navbar navbar-inverse navbar-fixed-top" style="display:none;">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#navbar" aria-expanded="false"
					aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="../../">菠萝</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li><a href="../../">主页</a></li>
					<li><a href="#">关于</a></li>
					<li><a href="#">联系我</a></li>
					<li class="dropdown"><a href="javascript:void(0);"
						class="dropdown-toggle" data-toggle="dropdown">我的项目<b
							class="caret"></b></a>
						<ul class="dropdown-menu">
							<li><a href="../jwsys/index.html">教务查询</a></li>
							<li><a href="../ttsys/index.html">铁通查询</a></li>
							<li><a href="#">尔雅题库</a></li>
						</ul></li>
				</ul>
			</div>
			<!--/.navbar-collapse -->
		</div>
	</nav>
	<div class="jumbotron">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="input-group">
						<input type="text" id="keyword" class="form-control"  placeholder="可以输入书名，作者名，甚至可以是符合条件的URL...">
						<span class="input-group-btn">
							<button class="btn btn-default" type="button" id="btnSearch">小说搜搜</button>
						</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container no-table-responsive">
		<table
			class="table table-striped table-bordered table-condensed table-hover">
			<thead>
				<tr style="text-align:center;font-style:800;">
					<th>#</th>
					<td>书名</td>
					<td>作者</td>
					<td>最新章节</td>
					<td>状态</td>
				</tr>
			</thead>
			<tbody id="list">
			</tbody>
			<!-- <tfoot>
				<tr>
					<td colspan="5">
						<div class="btn-group" style="float: right;">
							<button type="button" class="btn btn-default" id="currentPage">第1/100页</button>
							<button type="button" class="btn btn-default" id="firstPage">首页</button>
							<button type="button" class="btn btn-default" id="previousPage">上一页</button>
							<button type="button" class="btn btn-default" id="nextPage">下一页</button>
							<button type="button" class="btn btn-default" id="lastPage">尾页</button>
							<button type="button" class="btn btn-default" id="gotoPage">跳转</button>
							<input type="text" class="form-control" id="gotopage_text"
								style="width: 80px; display: inline-block" placeholder="页码">
							<input type="hidden" id="hidetxt" value="" />
						</div>
					</td>
				</tr>
			</tfoot> -->
		</table>
	</div>
	<!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.base64.js"></script>

	<script>
		$(function() {
			$("#btnSearch").click(search);
			$("#keyword").click(function(e) {
				$("#keyword").select();
			});
			$("#keyword").keydown(function(e) {
				if (e.keyCode == 13) {
					search();
				}
			});
		});
		function search() {
			var keyword = $("#keyword").val().trim();
			if (!keyword) {
				console.warn("没有输入关键词，不搜索");				
				return;
			}
			if (keyword.indexOf("www") == 0) {
				keyword = "http://" + keyword;	//协议补全
			}
			if (keyword.indexOf("http") == 0) {
				console.log(keyword + "\t是一个网页，直接跳转");
				searchByUrl(keyword);
			} else {
				console.log(keyword + "\t是普通关键词，去搜索");
				searchByKeyword(keyword);
			}
		}
		function searchByUrl(url) {
			window.open("./chapterList.action?base64Url=" + $.base64.encode(url))
		}
		function searchByKeyword(keyword) {
			$.ajax({
				url:"../novel/search.action",
				type:"post",
				dataType:"json",
				data:{
					"keyword":keyword,
				},
				error:function(data) {
					
				},
				success:function(data) {
					if (data.status == 1) {
						var $novels = data.data;
						$("#list").html("");
						$.each($novels, function(index, novel) {
							$("#list").append(createNovelTr(index, novel));
						});
					} else if (data.status == 0) {
						console.log(data.desc);
					} else {
						
					}
				}
			});
			function createNovelTr(index, novel) {
				var trHtml = '<tr>'
							+ '		<td>' + (index + 1) + '</td>'
							+ '		<td><a href="./novel/getChapters.action?base64Url=' + $.base64.encode(novel.url) + '" target="_blank">' + novel.name + '</a></td>'
							+ '		<td>' + novel.author + '</td>'
							+ '		<td><a href="./chapterList.action?base64Url=' + novel.lastUpdateChapterUrl + '" target="_blank">' + novel.lastUpdateChapter + '</a></td>'
							+ '		<td>' + ((novel.writingState == 1) ? "连载" : "完结") + '</td>'
							+ '</tr>';
				return $(trHtml);
			}
		}
	</script>
</body>
</html